<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìŠ¤í† ë¦¬ í˜ì´ì§€</title>
  <style>
    .write-link {
      display: block;
      width: 66.66%;
      margin: 60px auto 20px auto;
      text-decoration: none;
    }

    #text-input {
      width: 100%;
      max-width: 1100px;
      box-sizing: border-box;
      text-align: center;
      font-size: 1.3em;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin: 40px auto 20px;
      display: block;
      cursor: pointer;
    }

    .main-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  background-color: #f0f0f0;
  padding-bottom: 0;
  margin-bottom: 0;
}

    .story-header {
      font-size: 24px;
      font-weight: bold;
      color: #222;
      margin-bottom: 20px;
    }

    .story-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-between;
    }

    .story-card {
      background-color: white;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 16px;
      box-sizing: border-box;
      width: calc(50% - 10px);
      display: flex;
      flex-direction: column;
    }

    .login-id {
      font-weight: bold;
      font-size: 14px;
      color: #444;
    }

    .story-title {
      font-size: 16px;
      font-weight: bold;
      margin: 8px 0;
    }

    .story-image {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 12px;
      margin: 12px 0;
    }

    .story-content {
      font-size: 14px;
      color: #333;
      white-space: pre-line;
      margin-bottom: 10px;
    }

    .hashtags {
      color: #007acc;
      font-size: 13px;
      margin-bottom: 12px;
    }

    .actions {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 14px;
      margin-top: auto;
    }
    
    .actions span {
      cursor: pointer;
      color: #666;
    }

    .like-button,
    .comment-button {
      cursor: pointer;
      color: #666;
    }

    .comments {
      margin-top: 10px;
      display: none;
    }

    .comment {
      font-size: 13px;
      color: #444;
      margin-bottom: 4px;
    }

    .more-comments {
      font-size: 13px;
      color: #007acc;
      cursor: pointer;
      text-decoration: underline;
    }
    
     @media screen and (max-width: 768px) {
      .story-card {
        width: 100%;
      }
    }
    
    /* íŒì—… ì˜¤ë²„ë ˆì´ (ì²˜ìŒì—” ìˆ¨ê¹€) */
.modal-overlay {
  display: none; /* ì²˜ìŒì—ëŠ” ìˆ¨ê²¨ë†”ìš” */
  position: fixed; /* í™”ë©´ì— ê³ ì • */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7); /* ë°˜íˆ¬ëª… ê²€ì • ë°°ê²½ */
  justify-content: center; /* ë‚´ìš©ì„ ê°€ìš´ë° ì •ë ¬ - flexbox ë˜ëŠ” grid í•„ìš” */
  align-items: center; /* ë‚´ìš©ì„ ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ - flexbox ë˜ëŠ” grid í•„ìš” */
  z-index: 1000; /* ë‹¤ë¥¸ ìš”ì†Œë“¤ ìœ„ì— ë³´ì´ë„ë¡ z-index ë†’ê²Œ ì„¤ì • */
  /* ì•„ë˜ ë‘ ì¤„ì€ ê°€ìš´ë° ì •ë ¬ì„ ìœ„í•´ ì¶”ê°€ (í•„ìš”ì— ë”°ë¼ display: flex ì‚¬ìš©) */
  display: flex; /* ì´ê²ƒìœ¼ë¡œ ê°€ìš´ë° ì •ë ¬ í™œì„±í™” */
}

/* íŒì—… ë‚´ìš© ì˜ì—­ */
.modal-content {
  background-color: #fff; /* í•˜ì–€ ë°°ê²½ */
  padding: 20px;
  border-radius: 8px; /* ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ */
  width: 90%; /* ë„ˆë¹„ */
  max-width: 500px; /* ìµœëŒ€ ë„ˆë¹„ */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* ê·¸ë¦¼ì íš¨ê³¼ */
  position: relative; /* ë‹«ê¸° ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì •ì„ ìœ„í•´ */
  max-height: 80vh; /* í™”ë©´ ë†’ì´ì˜ 80%ë¥¼ ë„˜ì§€ ì•Šë„ë¡ */
  overflow-y: auto; /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ë°” ìƒì„± */
}

/* ë‹«ê¸° ë²„íŠ¼ */
.close-button {
  position: absolute; /* modal-content ê¸°ì¤€ ìœ„ì¹˜ ì„¤ì • */
  top: 10px;
  right: 20px;
  font-size: 24px;
  font-weight: bold;
  color: #aaa;
  cursor: pointer; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì†ê°€ë½ ëª¨ì–‘ */
}

.close-button:hover,
.close-button:focus {
  color: #777; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */
}

/* íŒì—…ì´ ë³´ì¼ ë•Œ */
.modal-overlay.visible {
    display: flex; /* JavaScriptì—ì„œ ì´ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•´ì„œ ë³´ì´ê²Œ í•  ê±°ì•¼ */
}

/* ëŒ“ê¸€ ëª©ë¡ ì˜ì—­ ìŠ¤íƒ€ì¼ (ì„ íƒ ì‚¬í•­) */
#comments-area {
    margin-top: 15px;
    /* ëŒ“ê¸€ ëª©ë¡ ìŠ¤íƒ€ì¼ì„ ì—¬ê¸°ì— ì¶”ê°€í•  ìˆ˜ ìˆì–´ */
}
  </style>
</head>
<body>
  <th:block th:replace="story/mainMenu :: mainMenu"></th:block>

  <a href="/weUpload" class="write-link">
    <input id="text-input" type="text" placeholder="ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. ğŸ‘‰" onclick="clearInPut(this)" readonly />
  </a>

  <div class="main-content">
    <div class="story-header">ìš°ë¦¬ì˜ ìŠ¤í† ë¦¬</div>

    <div class="story-container">
      <div class="story-card" th:each="story : ${cardList}"
           onclick="window.location.href = '[[@{/story/detail(id=${story.storyId})}]]'" style="cursor: pointer;">
        <div class="login-id" th:text="'@' + ${story.loginId}">ì•„ì´ë””</div>
        <div class="story-title" th:text="${story.storyTitle}">ìŠ¤í† ë¦¬ ì œëª©</div>

        <!-- ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°ë§Œ ì¶œë ¥ -->
<img class="story-image"
     th:if="${story.storyImgUrl != null and !#strings.isEmpty(story.storyImgUrl)}"
     th:src="${story.storyImgUrl}" alt="story image" />

        <!-- í•­ìƒ ì¶œë ¥ë˜ëŠ” ë‚´ìš© -->
        <div class="story-content" th:text="${story.storyContent}">ë‚´ìš©</div>

        <!-- í•´ì‹œíƒœê·¸ ì¶œë ¥ -->
        <div class="hashtags" th:if="${story.hashTags != null}">
          <span th:each="tag : ${story.hashTags}" th:text="'#' + ${tag} + ' '"></span>
        </div>

        <div class="actions">
          <span class="like-button" th:data-id="${story.storyId}" th:text="${story.isLike} ? 'ğŸ’— ê³µê°ì·¨ì†Œ' : 'ğŸ’— ê³µê°'"></span>
          <span class="like-count" th:text="${story.likes}">0</span>
          <span class="comment-button" onclick="toggleComment(this)">ğŸ’¬ ëŒ“ê¸€ì“°ê¸°</span>
        </div>

        <div class="comments comment-section">
          <form method="post" th:object="${storyCommentDto}"  action="/comment">
          	<input type="hidden" name="storyId"  th:value="${story.storyId}">
            <input type="text" th:field="*{commentContent}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" />
            <button type="submit">ë“±ë¡</button>
          </form>
          <div class="comment-list">
			    <a href="/story/detail" class="more-comments">ëŒ“ê¸€ ë”ë³´ê¸°</a>
			</div>
			
      </div>
    </div>
  </div>

  <th:block th:replace="story/mainFooter :: mainFooter"></th:block>

  <script>
    function clearInPut(el) {
      if (el.value === "ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”.") el.value = "";
    }
    
    function goToMyStory() {
        window.location.href = "/myStory";
      }

    function toggleComment(button) {
      const storyCard = button.closest(".story-card");
      const commentSection = storyCard.querySelector(".comment-section");
      if (commentSection) {
        commentSection.style.display =
          commentSection.style.display === "none" || commentSection.style.display === ""
            ? "block"
            : "none";
      }
    }
    
   // ëŒ“ê¸€ ë”ë³´ê¸° 
   document.addEventListener('DOMContentLoaded', function() {
    // í•„ìš”í•œ ìš”ì†Œë“¤ì„ ê°€ì ¸ì™€ìš” (ì´ì „ê³¼ ë™ì¼)
    const moreCommentsLink = document.querySelector('.more-comments');
    const commentModal = document.getElementById('comment-modal');
    const closeButton = commentModal.querySelector('.close-button');
    const commentsArea = document.getElementById('comments-area');

    // 'ëŒ“ê¸€ ë”ë³´ê¸°' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    if (moreCommentsLink) {
        moreCommentsLink.addEventListener('click', function(event) {
            event.preventDefault(); // ê¸°ë³¸ ë§í¬ ì´ë™ ë§‰ê¸°

            // íŒì—…ì°½
            commentModal.classList.add('visible');

            // íŒì—…ì°½ì´ ë‚˜íƒ€ë‚  ë•Œ ëŒ“ê¸€
            loadComments(); // ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ í˜¸ì¶œ

            console.log('íŒì—…ì°½ì„ ë³´ì´ê²Œ í•˜ê³  ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
        });
    }

    // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ì „ê³¼ ë™ì¼)
    if (closeButton) {
        closeButton.addEventListener('click', function() {
            commentModal.classList.remove('visible');
            // íŒì—… ë‹«ì„ ë•Œ ëŒ“ê¸€ ëª©ë¡ì„ ë¹„ìš°ê¸°
            commentsArea.innerHTML = "<p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>"; 
            console.log('íŒì—…ì°½ì„ ë‹«ì•˜ì–´ìš”.');
        });
    }

    // íŒì—… ì˜¤ë²„ë ˆì´ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸° (ì„ íƒ ì‚¬í•­, ì´ì „ê³¼ ë™ì¼)
    if (commentModal) {
        commentModal.addEventListener('click', function(event) {
            if (event.target === commentModal) {
                commentModal.classList.remove('visible');
                commentsArea.innerHTML = "<p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
                console.log('íŒì—… ì˜¤ë²„ë ˆì´ ë°°ê²½ì„ í´ë¦­í•˜ì—¬ íŒì—…ì„ ë‹«ì•˜ì–´ìš”.');
            }
        });
    }

    // Esc í‚¤ ëˆŒë €ì„ ë•Œ íŒì—… ë‹«ê¸° (ì„ íƒ ì‚¬í•­, ì´ì „ê³¼ ë™ì¼)
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && commentModal.classList.contains('visible')) {
            commentModal.classList.remove('visible');
            commentsArea.innerHTML = "<p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
            console.log('Esc í‚¤ë¥¼ ëˆŒëŸ¬ íŒì—…ì„ ë‹«ì•˜ì–´ìš”.');
        }
    });

    // === ëŒ“ê¸€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ ===
    function loadComments() {
        
        const commentsApiUrl = 'https://jsonplaceholder.typicode.com/posts/1/comments'; 

        // ëŒ“ê¸€ ë¡œë”© ì‹œì‘ ì‹œ ë©”ì‹œì§€ í‘œì‹œ
        commentsArea.innerHTML = "<p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";

        // Fetch APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        fetch(commentsApiUrl)
            .then(response => {
                // HTTP ì‘ë‹µ ìƒíƒœ í™•ì¸
                if (!response.ok) {
                    // ì‘ë‹µì´ ì„±ê³µì ì´ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œ catch ë¸”ë¡ìœ¼ë¡œ ë„˜ê²¨ìš”
                    throw new Error('HTTP error! status: ' + response.status);
                }
               
                return response.json();
            })
            .then(comments => {
                // JSON íŒŒì‹±ì´ ì™„ë£Œë˜ë©´ ëŒ“ê¸€ ë°ì´í„°
                console.log('ëŒ“ê¸€ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ì–´ìš”:', comments);

                // commentsAreaë¥¼ ë¹„ì›Œì£¼ê³  ìƒˆë¡œìš´ ëŒ“ê¸€ ëª©ë¡
                commentsArea.innerHTML = ''; // ì´ì „ ë‚´ìš© ì‚­ì œ

                if (comments && comments.length > 0) {
                    // ëŒ“ê¸€ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ëª©ë¡
                    let commentsHtml = '';
                    comments.forEach(comment => {
                      
                        commentsHtml += `
                            <div class="comment">
                                <strong>${comment.name}</strong> (${comment.email})<br>
                                <p>${comment.body}</p>
                            </div>
                            <hr> <!-- ëŒ“ê¸€ êµ¬ë¶„ì„  -->
                        `;
                    });
                    commentsArea.innerHTML = commentsHtml; 

                } else {
                    // ëŒ“ê¸€ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
                    commentsArea.innerHTML = "<p>ì•„ì§ ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                }
            })
            .catch(error => {
                // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°ë‚˜ ì²˜ë¦¬ ê³¼ì •ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒ
                console.error('ëŒ“ê¸€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì—ëŸ¬ ë°œìƒ:', error);
                commentsArea.innerHTML = "<p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>";
            });
    }
});

    document.addEventListener("DOMContentLoaded", function () {
      // ê³µê° ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
      document.querySelectorAll(".like-button").forEach((btn) => {
        btn.addEventListener("click", function () {
          const card = this.closest(".story-card");
          const countSpan = card.querySelector(".like-count");
          let count = parseInt(countSpan.textContent) || 0;
          if (this.classList.contains("liked")) {
            this.classList.remove("liked");
            this.textContent = "ğŸ’— ê³µê°";
            count--;
          } else {
            this.classList.add("liked");
            this.textContent = "ğŸ’— ê³µê°ì·¨ì†Œ";
            count++;
          }
          countSpan.textContent = Math.max(0, count);
        });
      });
    });
  </script>
</body>
</html>
